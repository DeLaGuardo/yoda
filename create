#!/usr/bin/env bash
[[ -z "$1" ]] &&  echo 'Usage: OPTS="" '$0' name-of-container [image-to-run]' && exit 255
docker=$(cd `dirname $0` && pwd)
image=${2-centos:7}
if [[ -f "$image" ]]; then
  $docker/utils/import ${image%%.*} $image
fi

test ! -d $docker/containers && mkdir $_
init=$docker"/containers/$1"
if [[ ! -f $init ]]; then
  cp -f $docker/init $init
fi

test ! -d $docker/storage/$1 && mkdir -p $_
docker create --name "$1" --hostname "$1" --restart=always --cap-add=NET_ADMIN \
  -v $init:/init -v $docker/storage/$1:/storage $OPTS -i -t $image /init
